
#Bootstrap: docker
#From: biopython/biopython
#https://hub.docker.com/r/biopython/biopython/dockerfile

BootStrap: library
From: ubuntu:18.04


%help

This container launches the LRRprofiler pipeline used to annot proteins with Leucine Rich Repeat motifs.
=======================================================================================

    usage (help)   : LRRprofiler_v0.1.sif
    usage (basic)  : LRRprofiler_v0.1.sif --in_proteome <fasta file> --name <string>
    usage (example): LRRprofiler_v0.1.sif --in_proteome Oryza_Sativa_japonica_IRGSP_v1_0.fasta --name ORYSJ 

For more details please see the pipeline documentation pages on the LRRprofiler website:
==================================================================================
#https://bioweb.supagro.inra.fr/LRRprofiler


If you use this pipeline please cite:
=====================================

    --------------------------------------

MAFFT v7.271 
    Katoh K., Standley D.M. (2013). MAFFT multiple sequence alignment software version 7: improvements in performance and usability. Molecular biology and evolution, 30(4), 772-780. Edgar R.C. (2004). 

SMART database
    ....

HMMER v3.1b2
    ....
	
iTAK 
	....
    --------------------------------------
#https://packages.ubuntu.com/search?suite=default&section=all&arch=any&keywords=biopython&searchon=names

%files
    tmhmm2.0c.tar

%post
	apt-get -y update
	apt-get -y install software-properties-common
	add-apt-repository universe

    apt-get -y update 
	apt-get -y install python3-biopython
	apt-get -y install gawk
    apt-get -y install unzip
    apt-get -y install wget
    apt-get -y install hmmer
    apt-get -y install mafft
	apt-get -y install r-base
	apt-get -y install r-base-dev
	apt-get -y install pandoc-data
	apt-get -y install pandoc

    
	##if BioPerl is not found using apt-get, the sources.list needs to be update
	## corrected with "add-apt-repository universe"
#echo "
#deb http://nova.clouds.archive.ubuntu.com/ubuntu/ bionic main restricted
#deb http://nova.clouds.archive.ubuntu.com/ubuntu/ bionic-updates main restricted
#deb http://nova.clouds.archive.ubuntu.com/ubuntu/ bionic universe
#deb http://nova.clouds.archive.ubuntu.com/ubuntu/ bionic-updates universe
#deb http://nova.clouds.archive.ubuntu.com/ubuntu/ bionic multiverse
#deb http://nova.clouds.archive.ubuntu.com/ubuntu/ bionic-updates multiverse
#deb http://nova.clouds.archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse
#deb http://security.ubuntu.com/ubuntu bionic-security main restricted
#deb http://security.ubuntu.com/ubuntu bionic-security universe
#deb http://security.ubuntu.com/ubuntu bionic-security multiverse" >> /etc/apt/sources.list

	apt-get -y install bioperl
 
	## neened to install subversion
    apt-get -y update
    apt-get -y install subversion
 
    ## pour récuperer les scripts sur github (penser à donner les droits au scripts)
	svn checkout https://github.com/kentnf/iTAK/trunk/
    mv trunk iTAK
	svn checkout https://github.com/cgottin/LRRprofiler/trunk/src/
	svn checkout https://github.com/cgottin/LRRprofiler/trunk/HMM_lib/
	svn checkout https://github.com/cgottin/LRRprofiler/trunk/example

	chmod 777 /src/*
	chmod -R 777 /iTAK/
	
	tar -xf /tmhmm2.0c.tar
	
	# running iTAK on test set to set up files
	perl /iTAK/iTAK.pl /iTAK/test_seq
	
	R --slave -e 'install.packages("rmarkdown")'
    
	#Cleaning
	rm -rf /var/lib/apt/lists/*
	#apt-get purge -y --auto-remove subversion wget unzip
	apt-get clean

%environment
	export LC_ALL=C
    export LG_SCRIPT="/src"
	export LG_HMMlib="/HMM_lib"
    export LG_MAFFT="mafft"
    export LG_ITAK="/iTAK/iTAK.pl"
	export LG_TMHMM="/tmhmm2.0c/bin/tmhmm"
	R_VERSION=3.6.1
	export R_VERSION
	R_CONFIG_DIR=/etc/R/
	export R_CONFIG_DIR
	export PATH=$PATH
    

    

%runscript
    exec bash /src/LRRprofiler_global.sh "$@"

%labels
    Author Céline Gottin & Vincent Ranwez

#sudo singularity  build LRRprofiler_v0.1.sif LRRprofiler_v0.1_sing_3.3.def
#singularity run LRRprofiler_v0.1.sif
#singularity run -help LRRprofiler_v0.1.sif
